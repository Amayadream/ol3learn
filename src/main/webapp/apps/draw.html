<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <title>地图展示</title>
    <link rel="stylesheet" type="text/css" href="openlayers3/css/ol.css">
    <script src="openlayers3/js/ol.js"></script>
</head>
<body>
<a href="javascript:drawFeature('Point')">Point</a>
<a href="javascript:drawFeature('LineString')">LineString</a>
<a href="javascript:drawFeature('Polygon')">Polygon</a>
<a href="javascript:drawFeature('Circle')">Circle</a>
<a href="javascript:drawFeature('Square')">Square</a>
<a href="javascript:drawFeature('Box')">Box</a>
<div id="map" style="width: 100%; height: 400px"></div>
<script>
    var raster  = new ol.layer.Tile({
        source: new ol.source.OSM({
            attributions: [
                new ol.Attribution({
                    html: "hello, welcome to my website <a href='http://www.amayadream.com' target='_blank'>Amayadream</a>"
                })
            ]
        })
    });
    var source = new ol.source.Vector({wrapX: false});
    var vector = new ol.layer.Vector({
        controls: ol.control.defaults().extend([
            new ol.control.ScaleLine()
        ]),
        source: source,
        style: new ol.style.Style({
            fill: new ol.style.Fill({
                color: 'rgba(255, 255, 255, 0.2)'
            }),
            stroke: new ol.style.Stroke({
                color: '#ffcc33',
                width: 2
              }),
              image: new ol.style.Circle({
                   radius: 7,
                fill: new ol.style.Fill({
                      color: '#ffcc33'
                })
              })
        })
    });
    var map = new ol.Map({
        layers: [raster, vector],
        view: new ol.View({
          center: ol.proj.transform([116,39], 'EPSG:4326', 'EPSG:3857'),
          zoom: 9
        }),
        controls: ol.control.defaults({
            attributionOptions: ({
                collapsible: true
            })
        }).extend([
            new ol.control.ScaleLine(), new ol.control.FullScreen(), new ol.control.ZoomSlider()
        ]),
        target: 'map'
    });
    var drawLayer;
      function drawFeature(x){
    map.removeInteraction(drawLayer);
    var geometryFunction, maxPoints;
    if(x =='Square'){
        x = 'Circle';
        geometryFunction = ol.interaction.Draw.createRegularPolygon(4);
    }
    if(x == 'Box'){
        x = 'LineString';
        maxPoints = 2;
        geometryFunction = function(coordinas, geometry){
            if(!geometry){
                geometry = new ol.geom.Polygon(null);
            }
            var start = coordinas[0];
            var end = coordinas[1];
            geometry.setCoordinates([
                [start, [start[0], end[1]], end, [end[0], start[1]], start]
            ]);
            return geometry;
          };
    }
    drawLayer = new ol.interaction.Draw({
        source: source,
        type: x,
        geometryFunction: geometryFunction,
        maxPoints: maxPoints,
    });
    map.addInteraction(drawLayer);
  }
</script>
</body>
</html>